#include "mbed.h"
#include "C12832.h"
//#include "QEI.h"

//global variables

C12832 lcd(D11,D13,D12,D7,D10);

PwmOut pwmRight(PA_15);      //sets pwm pin 
PwmOut pwmLeft(PB_7);       //sets left wheel control through pwm
InterruptIn middle(D4);
DigitalOut enable(PA_13);
DigitalOut directionLeft(PA_14);
DigitalOut directionRight(PC_14);

typedef enum{startUp, pwmOn}programState;
programState state;
programState lastState;

//QEI rightWheel(PA_13, PA_14, PC_14,1);


//Functions Start

void nextState(){
    switch(state){
        case(startUp):
            state = pwmOn;
        break;
        case(pwmOn):
            state = startUp;
        break;
    }
}

//Encoder intterupt functio, uses a timed interrupt to check at set frequency --> interrupt calls another 

/*void encoderValue(){
    int pulscounts;
    

}*/



// main() runs in its own thread in the OS
int main()
{

    enable = 0;
    middle.rise(&nextState);
    state = startUp;
    lastState = pwmOn;

    while (true) {
         
        

    
        //main state code insert here


        if (state != lastState){

            switch (state) {
            case startUp:
                enable = 0;
                pwmRight.write(0.0f);
                pwmLeft.write(0.0f);
                lcd.cls();
                lcd.locate(0,0);
                lcd.printf("Start Screen");
                lastState = startUp;
                break;
            case pwmOn:
                directionLeft = 1;
                directionRight = 0;
                enable = 1;
                lcd.cls();
                lcd.locate(0,0);
                lcd.printf("Pwm Mode On Testing ...");
                pwmRight.period(0.002f);
                pwmRight.write(0.8f);
                pwmLeft.period(0.002f);
                pwmLeft.write(0.8f);



                lastState = pwmOn;
                break;
            }
        }


    }
}


